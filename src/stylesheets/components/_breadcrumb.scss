
// This helps balance spacing around inline-block elements
$gap-inline-spacer: -.25em;
$breadcrumb-icon-height: 1.35ex;

@mixin breadcrumb-icon($icon: $theme-breadcrumb-separator-icon, $dim: $theme-breadcrumb-separator-icon-dim) {
  $aspect: nth($dim, 1) / nth($dim, 2);
  // 1. Possible mixin code.
  $image-name: unquote($icon); // 1
  background-color: color($theme-breadcrumb-icon-color); // 1
  mask: url("#{$image-name}") no-repeat center; // 1
  mask-size: ($breadcrumb-icon-height * $aspect) $breadcrumb-icon-height; // 1
  content: "";
  display: inline-block;
  padding: ($breadcrumb-icon-height / 2) ($breadcrumb-icon-height * $aspect / 2);
}

.usa-breadcrumb {
  @include typeset;
  @include at-media($theme-breadcrumb-min-width) {
    @include u-margin-bottom($theme-breadcrumb-spacing-bottom);
    @include u-margin-top($theme-breadcrumb-spacing-top);
  }
}

.usa-breadcrumb__list {
  // Prefer flex but breaks ellipsis
  @include u-display("block");
  @include unstyled-list;

  @if not $theme-breadcrumb-wrapping {
    @include u-white-space("no-wrap");
    text-overflow: ellipsis;
    overflow: hidden;
  }
}

.usa-breadcrumb__list-item {
  @include sr-only;
  @include u-display("inline");
  @include u-white-space("no-wrap");

  @include at-media-max($theme-breadcrumb-min-width) {

    // ⃪ Parent link.
    &:nth-last-child(2) {
      @include not-sr-only;

      .usa-breadcrumb__link {
        @include button-unstyled;
        @include u-padding-top($theme-breadcrumb-spacing-top);
        @include u-padding-bottom($theme-breadcrumb-spacing-bottom);
      }

      .usa-breadcrumb__link::before {
        @include breadcrumb-icon($theme-breadcrumb-back-icon, $theme-breadcrumb-back-icon-dim);
        margin-right: calc(
          #{units($theme-breadcrumb-gap)} + #{$gap-inline-spacer}
        );
      }
    }
  }

  @include at-media($theme-breadcrumb-min-width) {
    @include not-sr-only;

    &:not(:last-child)::after {
      @include breadcrumb-icon;
      margin-left: calc(
        #{units($theme-breadcrumb-gap)} + #{$gap-inline-spacer}
      );
      margin-right: calc(
        #{units($theme-breadcrumb-gap)} + #{$gap-inline-spacer}
      );
    }
  }
}

.usa-breadcrumb__link {
  // Prefer inline-flex but breaks ellipsis
  @include u-display("inline");
  @include u-text($theme-link-color);
  // Reduce jitter from desktop → mobile.
  transition: padding $theme-easing;
}
