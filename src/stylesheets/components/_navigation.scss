// Navigation helpers
// ---------------------------------

@mixin outer-megamenu {
  @include u-pin('y');
  background-color: color('primary-darker');
  content: '';
  display: block;
  position: absolute;
  width: 100%;
}

@mixin primary-nav-link {
  line-height: line-height($theme-font-family-navigation, 1);
  padding: units(2);
}

$nav-link-color: 'base-dark';
$sliding-panel-width: 'card-lg';
$nav-link-accordion-icon-size: 1.5;
$nav-link-arrow-icon-size: 1;

// TODO: Collect animations in a common location?
@keyframes slidein-left {
  from {
    transform: translateX(units($sliding-panel-width));
  }

  to {
    transform: translateX(0);
  }
}

// Header navigation
// ---------------------------------

.usa-navbar {
  border-bottom: units(1px) solid color('base-light');
  height: units($touch-target-size);

  @include at-media-max($theme-nav-width) {
    @include u-flex('align-center');
    display: flex;
  }

  @include at-media($theme-nav-width) {
    border-bottom: none;
    display: inline-block;
    height: auto;
  }
}

.usa-nav-container {
  @include at-media($theme-nav-width) {
    @include clearfix;
    @include grid-container($theme-site-max-width);
    @include u-padding-x($theme-site-margins);
  }
}

.usa-nav {
  @include typeset($theme-font-family-navigation, null, 1);
  @include at-media-max($theme-nav-width) {
    @include u-pin('right');
    @include u-pin('y');
    position: fixed;
    background: color('white');
    border-left: units(1px) solid color('base-light');
    border-right: 0;
    display: none;
    flex-direction: column;
    overflow-y: auto;
    padding: units(2.5);
    width: units($sliding-panel-width);
    z-index: z-index(500);

    &.is-visible {
      animation: slidein-left 0.3s ease-in-out;
      display: flex;
    }
  }

  @include at-media($theme-nav-width) {
    float: right;
    position: relative;
  }

  .usa-search {
    @include at-media($theme-nav-width) {
      margin-left: units(2);
    }
  }
}

// Primary navigation
// ---------------------------------

.usa-nav-primary {

  // Until the $theme-nav-width,
  // use the usa-nav-list styles for the slide-in nav
  @include at-media-max($theme-nav-width) {
    @include nav-list;
    margin-top: units(3);
    order: 2;

    a {
      @include u-padding-y(1.5);
    }
  }

  // At $theme-nav-width and wider...
  @include at-media($theme-nav-width) {
    display: flex;
  }

  // all nav items in the nav
  .usa-nav-item {
    a {
      text-decoration: none;
    }
  }

  // just level 1 nav items...
  > .usa-nav-item {
    line-height: line-height($theme-font-family-navigation, 2);
    @include at-media($theme-nav-width) {
      font-size: scale($theme-font-family-navigation, '2xs');
      line-height: line-height($theme-font-family-navigation, 1);
    }

    // ...and their direct links
    > a {
      @include at-media($theme-nav-width) {
        @include primary-nav-link;
        color: color($nav-link-color);
        display: block;
        font-weight: font-weight('bold');

        &:hover {
          color: color('primary');
        }
      }
    }
  }

  a {
    @include at-media($theme-nav-width) {
      @include u-padding-y(1);
    }
  }

  button {
    $button-vertical-offset: 53%; // XXX: Magic number

    @include button-unstyled;
    color: color($nav-link-color);
    font-weight: font-weight('normal');
    line-height: line-height($theme-font-family-navigation, 2);
    padding: units(1.5) units(2);

    @include at-media($theme-nav-width) {
      @include primary-nav-link;
      font-size: scale($theme-font-family-navigation, '2xs');
      font-weight: font-weight('bold');
    }

    &:focus,
    &:active {
      // TODO: check this var
      box-shadow: $focus-outline;
    }

    &:hover {
      color: color('primary');
      background-color: color('base-lightest');
      @include at-media($theme-nav-width) {
        background-color: transparent;
      }
    }

    &[aria-expanded=false] { /* stylelint-disable-line selector-no-qualifying-type */
      @include add-background-image('plus-alt');
      background-repeat: no-repeat;
      background-position: right 0 center;
      background-size: units($nav-link-accordion-icon-size);

      @include at-media($theme-nav-width) {
        @include add-background-image('angle-arrow-down');
        background-size: units($nav-link-arrow-icon-size);
        background-position: right units(2) top $button-vertical-offset;
      }

      &:hover {
        @include at-media($theme-nav-width) {
          @include add-background-image('angle-arrow-down-primary');
        }
      }
    }

    &[aria-expanded=true] { /* stylelint-disable-line selector-no-qualifying-type */
      @include add-background-image('minus-alt');
      background-repeat: no-repeat;
      background-position: right 0 center;
      background-size: units($nav-link-accordion-icon-size);

      @include at-media($theme-nav-width) {
        @include add-background-image('angle-arrow-down-hover');
        background-size: units($nav-link-arrow-icon-size);
        background-color: color('primary-darker');
        background-position: right units(2) top $button-vertical-offset;
        color: color('white');
      }
    }
  }

  .usa-accordion-button {
    span {
      @include at-media($theme-nav-width) {
        margin-right: 0;
        padding-right: units(2);
      }
    }
  }
}

// Secondary navigation
// ---------------------------------

.usa-nav-secondary {
  margin-top: units(2);

  @include at-media($theme-nav-width) {
    // Note: Previius calc() couldn't work. don't hardcode rem vals
    bottom: units(8); // XXX magic number
    font-size: scale($theme-font-family-navigation, '2xs');
    margin-top: units(1);
    min-width: calc(#{$search-min-width} + #{$usa-btn-small-width});
    position: absolute;
    right: units($theme-site-margins);
  }

  .usa-search {
    margin-top: units(2);
    width: 100%;

    @include at-media($theme-nav-width) {
      margin-left: 0;
      margin-top: units(1);
    }
  }
}

.usa-nav-secondary-links {
  @include add-list-reset;
  line-height: line-height($theme-font-family-navigation, 3);
  margin-top: units(3);

  @include at-media($theme-nav-width) {
    float: right;
    line-height: line-height($theme-font-family-navigation, 1);
    margin-bottom: units(0.5);
    margin-top: 0;
  }

  .usa-nav-secondary-item {
    @include at-media($theme-nav-width) {
      display: inline;
      padding-left: units(0.5);

      & + .usa-nav-secondary-item::before {
        color: color('base-lighter');
        content: '|';
        padding-right: units(0.5);
      }
    }
  }

  a {
    color: color('base');
    display: inline-block;
    font-size: scale($theme-font-family-navigation, '2xs');
    text-decoration: none;

    &:hover {
      color: color('primary');
      text-decoration: underline;
    }
  }
}

// Navigation dropdowns
// ---------------------------------

.usa-nav-submenu {
  @include at-media-max($theme-nav-width) {
    @include nav-sublist;
  }

  @include at-media($theme-nav-width) {
    @include add-list-reset;
    background-color: color('primary-darker');
    width: units('card-lg');
    padding: units(2);
    position: absolute;
  }

  &[aria-hidden=true] {
    display: none;
  }

  .usa-nav-item {
    @include at-media($theme-nav-width) {
      & + * {
        margin-top: units(1.5);
      }

      a {
        color: color('white');
        padding: 0;

        &:hover {
          background-color: transparent;
          color: color('white');
          padding: 0;
          text-decoration: underline;
        }
      }
    }
  }
}

.usa-nav-submenu-list {
  @include unstyled-list;

  .usa-nav-item {
    margin: 0;
    font-size: scale($theme-font-family-navigation, '2xs');

    a {
      line-height: line-height($theme-font-family-navigation, 3);
    }
  }
}

// Navigation close button
// ---------------------------------

.usa-nav-close {
  @include button-unstyled;
  @include u-square($touch-target-size);
  color: currentColor;
  float: right;
  margin: units(-1.5) units(-2) units(2) auto;
  text-align: center;

  &:hover {
    color: currentColor;
  }

  @include at-media($theme-nav-width) {
    display: none;
  }

  img {
    width: units(1.5);
  }

  + * {
    clear: both;
  }
}

.usa-mobile_nav-active {
  overflow: hidden;
}

// Navigation megamenu
// ---------------------------------

.usa-megamenu {
  @include at-media($theme-nav-width) {
    @include u-padding-x(0);
    @include u-padding-y(4);
    left: -$theme-megamenu-logo-text-width;
    right: 0;
    width: auto;
  }

  &::before {
    @include at-media($theme-nav-width) {
      @include outer-megamenu;
      right: 100%;
    }
  }

  &::after {
    @include at-media($theme-nav-width) {
      @include outer-megamenu;
      left: 100%;
    }
  }
}
